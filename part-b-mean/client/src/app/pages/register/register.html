<main class="register-container">
  <h1>{{ auth.isLoggedIn ? 'Your Profile' : 'Create Your Account' }}</h1>
  <p>
    {{ auth.isLoggedIn
    ? 'Update your information and see the courses you’re subscribed to.'
    : 'Join our learning community and start your journey today.' }}
  </p>
  <a *ngIf="auth.isLoggedIn" (click)="logout()" style="cursor: pointer;">Logout</a>
  <div class="form-column login__col" *ngIf="!auth.isLoggedIn">
    <p>Already having an account? </p>
    <a class="login__btn" routerLink="/login">Login Here</a>
  </div>


  <form (ngSubmit)="submit()" #f="ngForm" id="register-form" class="register-form">
    <!-- USER INFORMATION -->

    <div class="from-row">
      <div class="form-column">
        <label for="firstName">First Name</label>
        <input name="firstName" [(ngModel)]="form.firstName" type="text" id="firstName" autocomplete="given-name"
          required />
      </div>

      <div class="form-column">
        <label for="lastName">Last Name</label>
        <input name="lastName" [(ngModel)]="form.lastName" type="text" id="lastName" autocomplete="family-name"
          required />
      </div>
    </div>

    <div class="form-column">
      <label for="userName">Username</label>
      <input name="userName" [(ngModel)]="form.userName" type="text" id="userName" autocomplete="username" required />
    </div>

    <div class="form-column">
      <label for="email">Email</label>
      <input name="email" [(ngModel)]="form.email" type="email" id="email" autocomplete="email" required />
    </div>

    <div class="form-column">
      <label for="dob">Date of Birth</label>
      <input name="dob" [(ngModel)]="form.dob" type="date" id="dob" autocomplete="bday" required />
    </div>

    <!-- ACCOUNT DETAILS -->

    <div class="from-row" *ngIf="!auth.isLoggedIn">
      <div class="form-column">
        <label for="password">Password</label>
        <input name="password" [(ngModel)]="form.password" type="password" id="password" required minlength="6"
          pattern="(?=.*[A-Za-z])(?=.*[0-9]).{6,}"
          title="Must contain at least 6 characters, one letter, and one number." autocomplete="new-password" />
      </div>
      <div class="form-column">
        <label for="confirmPassword">Confirm Password</label>
        <input name="confirmPassword" [(ngModel)]="form.confirmPassword" type="password" id="confirmPassword"
          autocomplete="new-password" required />
      </div>
    </div>

    <!-- LEARNING PREFERENCES -->

    <div class="form-column">
      <label for="interest">Choose Category</label>
      <select name="interest" [(ngModel)]="form.interest" id="interest" required>
        <option value="" disabled>Preferred Category</option>
        <option value="programming">Programming</option>
        <option value="networks">Networks</option>
        <option value="cybersecurity">Cybersecurity</option>
        <option value="databases">Databases</option>
        <option value="web-development">Web Development</option>
        <option value="ai">Artificial Intelligence</option>
      </select>
    </div>

    <div class="form-column">
      <label for="level">Experience level</label>
      <select name="level" [(ngModel)]="form.level" id="level" required>
        <option value="" disabled>Experience Level</option>
        <option value="beginner">Beginner</option>
        <option value="intermediate">Intermediate</option>
        <option value="advanced">Advanced</option>
      </select>
    </div>

    <div class="form-column">
      <fieldset class="goals-fieldset">
        <legend class="goal-label">Your goal is:</legend>

        <label class="radio-row">
          <input type="radio" name="goal" [(ngModel)]="form.goal" value="exam-prep" required />
          Exam preparation (structured revision)
        </label>

        <label class="radio-row">
          <input type="radio" name="goal" [(ngModel)]="form.goal" value="portfolio" required />
          Build a portfolio (projects & practice)
        </label>

        <label class="radio-row">
          <input type="radio" name="goal" [(ngModel)]="form.goal" value="career" required />
          Career growth (job-ready skills)
        </label>

        <label class="radio-row">
          <input type="radio" name="goal" [(ngModel)]="form.goal" value="curiosity" required />
          Learn out of curiosity (explore topics)
        </label>
      </fieldset>
    </div>


    <div class="form-column last">
      <input type="checkbox" id="newsletter" name="newsletter" [(ngModel)]="form.newsletter" />
      <label for="newsletter"> Receive course recommendations</label>
    </div>

    <!-- Messages -->
    <p *ngIf="error" class="form-error">{{ error }}</p>
    <p *ngIf="success" class="form-success">{{ success }}</p>
    <!-- Messages -->

    <button type="submit" class="submit-btn"
      [disabled]="loading || f.invalid || (!auth.isLoggedIn && form.password !== form.confirmPassword)">
      {{ loading ? (auth.isLoggedIn ? 'Updating...' : 'Creating...') : (auth.isLoggedIn ? 'Update Profile' : 'Create
      Account') }}
    </button>

    <p *ngIf="form.password && form.confirmPassword && form.password !== form.confirmPassword" class="form-error">
      Passwords do not match.
    </p>

  </form>
</main>

<section class="enrollments-panel" id="enrollments-panel">
  <h2>Courses you’ve subscribed to:</h2>

  <!-- NOT logged in -->
  <ng-container *ngIf="!isProfileMode; else loggedInBlock">
    <p>You must register in order to enroll to courses!</p>
  </ng-container>

  <!-- logged in -->
  <ng-template #loggedInBlock>
    <!-- logged in but no enrollments -->
    <ng-container *ngIf="!enrollments.length; else hasEnrollments">
      <p>No enrollments yet. Browse <a routerLink="/courses" class="simple__rout">courses</a></p>
    </ng-container>

    <!-- logged in and has enrollments -->
    <ng-template #hasEnrollments>
      <ul>
        <li *ngFor="let e of enrollments">
          <a [routerLink]="['/course-details', (e.course?._id || e.course)]">
            {{ e.course?.title || e.course }}
          </a>
          <small *ngIf="e.createdAt">
            (enrolled: {{ e.createdAt | date:'mediumDate' }})
          </small>
        </li>
      </ul>
    </ng-template>
  </ng-template>
</section>